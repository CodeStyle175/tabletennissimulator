<!DOCTYPE>
<html>
	<head>
		<title>Table Tennis Game</title>
		<meta charset="UTF-8">
		<script type="text/javascript" src="static/three.r96.js"></script>
		<script type="text/javascript" src="static/MTLLoader.js"></script>
		<script type="text/javascript" src="static/OBJLoader.js"></script>
		<script type="text/javascript">

			var renderer, scene, camera;
			
			var table; //objects
			var controls;
			var assetsToLoad = 1;
			var textureLoader = new THREE.TextureLoader();
			
			function toRad(degree) {
				return Math.PI * 2 * degree / 360;
			}

			function millis() {
				return (new Date()).getTime();
			}
		
			function onLoad() { 
				var canvasContainer = document.getElementById('myCanvasContainer'); 
				var width = 800; 
				var height = 500;
				
				// Initially we show the loading text under the canvas
				statusContainer = document.getElementById('status'); 
				statusContainer.innerHTML = 'Loading...';
				
				renderer = new THREE.WebGLRenderer(); 
				renderer.setSize(width, height);
				renderer.gammaInput = true;
				renderer.gammaOutput = true;
				canvasContainer.appendChild(renderer.domElement);
				
				scene = new THREE.Scene();
				
				camera = new THREE.PerspectiveCamera(80, width / height, 1, 1000);
				camera.up = new THREE.Vector3(0, 1, 0);
				camera.position.set(0, -2, 15);

				var directionalLight = new THREE.DirectionalLight(0xffffff);
				directionalLight.position.set(1, 1, 1);
				scene.add(directionalLight);

				addHangar();

				var mtlLoader = new THREE.MTLLoader();
				mtlLoader.load('static/10520_pingpongtable_L2.mtl', function(materials) {
					var objLoader = new THREE.OBJLoader();
					objLoader.setMaterials(materials);
					objLoader.load('static/10520_pingpongtable_L2.obj', loadTable);
				});
			}

			function loadTable(table) {

				table.position.set(0, -10, 0);
				table.name = "Table";
				table.scale.set(0.05, 0.05, 0.05);
				table.rotation.set(toRad(-90), 0, 0);

				console.log(table);

				scene.add(table);
				
				if (!(--assetsToLoad)) {
					loaded();
				}
			}
			
			function onTextureLoaded(texture) {
				texture.wrapS = THREE.RepeatWrapping;
				texture.wrapT = THREE.RepeatWrapping;
				texture.repeat.set(2, 10);
				texture.needsUpdate = true;
				
				if (!(--assetsToLoad)) {
					loaded();
				}
			}
			
			function loaded() {
				statusContainer.innerHTML = 'Running.';
				draw();
			}
			
			function draw() {
				requestAnimationFrame(draw);
				renderer.render(scene, camera);
			}
			

			function addHangar() {
				var hangar = new THREE.Object3D();
				var halfPi = Math.PI / 2;
				
				var floor = createWall(0x222222, 20, 100);
				floor.position.set(0, -10, 40);
				floor.rotation.set(-halfPi, 0, 0);
				
				// We load this texture for the floor. Overriding the material assigned to us in the createWall
				floor.material = new THREE.MeshLambertMaterial({
					map: textureLoader.load('http://cglearn.eu/files/course/7/textures/wallTexture2.jpg', onTextureLoaded)
				});
				hangar.add(floor);
				
				scene.add(hangar);
			}
			
			function createWall(colorCode, width, height) {
				var geometry = new THREE.PlaneGeometry(width, height, width, height);
				var material = new THREE.MeshBasicMaterial({color: colorCode});
				var wall = new THREE.Mesh(geometry, material);
				
				return wall;
			}
			
		</script>
	</head>
	<body onload="onLoad()">
		<div id="myCanvasContainer"></div>
		<div id="stat"></div>
		<div id="status"></div>
	</body>
</html>